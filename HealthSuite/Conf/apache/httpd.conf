##
## httpd.conf -- Modified for Physia HealthSuite
##

### Section 1: Global Environment
ServerType standalone

# Only required if mod_perl built as a DSO
#LoadModule perl_module        /usr/local/apache/libexec/libperl.so

<PERL>
my $current_user = getpwuid($>) || $>;
my $current_group = getgrgid($)) || $);
push @PerlPassEnv, ['HS_HOME' => $ENV{HS_HOME}];
push @PerlPassEnv, ['HS_CONFIG' => $ENV{HS_CONFIG}];
if ($current_user eq 'root')
{
	$User = 'nobody';
	$Group = 'nobody';
#	$Port = 80;
#	$Listen = 80;
	$DocumentRoot = "/home/common/HealthSuite/WebSite";
	$MaxClients = 15;
	$StartServers = 5;
	$MinSpareServers = 1;
	$MaxSpareServers = 10;
}
else
{
	$User = $current_user;
	$Group = 'swdev';
	$Port = 8000 + $>;
	$Listen = 8000 + $>;
	$DocumentRoot = "/home/$current_user/projects/HealthSuite/WebSite";
	$MaxClients = 5;
	$StartServers = 2;
	$MinSpareServers = 1;
	$MaxSpareServers = 2;
}
</PERL>
PidFile logs/httpd.pid
ScoreBoardFile logs/httpd.scoreboard
ResourceConfig /dev/null
AccessConfig /dev/null
Timeout 300
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 15
MaxRequestsPerChild 0
ExtendedStatus on

### Section 2: 'Main' server configuration
ServerAdmin webmaster@physia.com
ServerName tokyo.physia.com
<Directory />
    Options FollowSymLinks
    AllowOverride None
</Directory>
<Location />
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    Allow from all
</Location>

AccessFileName .htaccess
<Files ~ "^\.ht">
    Order allow,deny
    Deny from all
</Files>

UseCanonicalName On

<IfModule mod_mime.c>
    TypesConfig /etc/mime.types
</IfModule>

DefaultType text/plain

<IfModule mod_mime_magic.c>
    MIMEMagicFile /etc/mime-magic
</IfModule>

HostnameLookups Off

ErrorLog logs/error_log

LogLevel debug

LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent

CustomLog logs/access_log common
CustomLog logs/referer_log referer
CustomLog logs/agent_log agent

ServerSignature Off

<IfModule mod_setenvif.c>
    BrowserMatch "Mozilla/2" nokeepalive
    BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0
    BrowserMatch "RealPlayer 4\.0" force-response-1.0
    BrowserMatch "Java/1\.0" force-response-1.0
    BrowserMatch "JDK/1\.0" force-response-1.0
</IfModule>

### Section 3: mod_perl config

PerlFreshRestart Off
PerlSetEnv ORACLE_HOME /u01/app/oracle/product/8.1.5
PerlRequire conf/startup.pl
PerlChildInitHandler Apache::HealthSuite::PracticeManagement::PerlChildInitHandler
<Location />
	SetHandler perl-script
	PerlHandler Apache::HealthSuite::PracticeManagement::PerlHandler
	Options +ExecCGI
</Location>
<Location /images>
	SetHandler default-handler
</Location>
<Location /lib>
	SetHandler default-handler
</Location>
<Location /resources>
	SetHandler default-handler
</Location>
<Location /temp>
	SetHandler default-handler
</Location>
<Location /server-status>
	SetHandler server-status
</Location>
<Location /perl-status>
	SetHandler perl-script
	PerlHandler Apache::Status
	Options +ExecCGI
</Location>

<IfDefine DEVEL>
	PerlModule Apache::StatINC
	PerlInitHandler Apache::StatINC
	PerlSetVar StatINC_Debug On
	PerlWarn Off
</IfDefine>

<IfDefine SSL>
	SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown
	AddType application/x-x509-ca-cert .crt
	AddType application/x-pkcs7-crl .crl
	SSLPassPhraseDialog builtin
	SSLSessionCache dbm:logs/ssl_scache
	SSLSessionCacheTimeout 300
	SSLRandomSeed startup builtin
	SSLRandomSeed connect builtin
	SSLLog logs/ssl_log
	SSLLogLevel info
	<Location />
		SSLRequireSSL
		ErrorDocument 403 https://tokyo.physia.com/
	</Location>
	<Perl>
		my $insecurePort = getpwuid($>) eq 'root' ? 80 : 8000 + $>;
		my $securePort = getpwuid($>) eq 'root' ? 443 : 9000 + $>;
		$Listen = $securePort;
		%{$VirtualHost{"_default_:$securePort"}} = (
			SSLEngine => 'on',
			SSLCertificateFile => '/root/ssl/tokyo_physia_com.cer',
			SSLCertificateKeyFile => '/root/ssl/key.pem',
			SSLProtocol => 'all',
			SSLCipherSuite => 'HIGH:MEDIUM',
		);
	</Perl>
</IfDefine>

<IfDefine XCONF>
	Include conf/extra.conf
</IfDefine>
