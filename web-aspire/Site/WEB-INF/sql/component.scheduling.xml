<?xml version="1.0"?>

<xaf>
	<sql-statements package="component.scheduling">
		<statement name="del_worklist_facilities">
			
			delete from Person_Attribute
			where parent_id = ?
			and value_type = 252
			and item_name = 'WorkList'
			and parent_org_id = ?
			
		</statement>

		<statement name="del_worklist_resources">
			
			delete from Person_Attribute
			where parent_id = ?
			and value_type = 250
			and item_name = ?
			and parent_org_id = ?
			
		</statement>

		<statement name="id">
			App::Statements::Component::Scheduling
		</statement>

		<statement name="sel_EventAttribute">
			
			select * from Event_Attribute where parent_id = :1
			and value_type = :2
			
		</statement>

		<statement name="sel_MostRecentVerify">
			
			select * from Sch_Verify where person_id = :1
			and cr_stamp = (select max(cr_stamp) from Sch_Verify where person_id = :1)
			
		</statement>

		<statement name="sel_accountBalance">
			
			select nvl(sum(balance), 0)
			from invoice
			where client_id = :1
			and invoice_status &gt; 3
			and invoice_status != 15
			and invoice_status != 16
			and balance &gt; 0
			
		</statement>

		<statement name="sel_alerts">
			
			select * from Transaction
			where trans_owner_id = ?
			and trans_owner_type = 0
			and trans_type between 8000 and 8999
			and trans_status = 2
			
		</statement>

		<statement name="sel_copay">
			
			select Insurance.copay_amt
			from Insurance, Invoice_Billing, Invoice
			where Invoice.invoice_id = :1
			and Invoice_Billing.bill_id = Invoice.billing_id
			and Insurance.ins_internal_id = Invoice_billing.bill_ins_id
			
		</statement>

		<statement name="sel_copayInfo">
			
			select extended_cost as amount, balance, item_id
			from Invoice_Item
			where parent_id = ?
			and item_type = 3
			
		</statement>

		<statement name="sel_detail_alerts">
			
			select Transaction.caption, detail, Transaction_Type.caption as trans_type, trans_subtype,
			to_char(trans_begin_stamp - :1, 'MM/DD/YYYY'),
			to_char(trans_end_stamp - :1, 'MM/DD/YYYY'),
			data_text_a, decode (trans_subtype, 'High', 1, 'Medium', 2, 'Low', 3, 3) as subtype_sort
			from Transaction_Type, Transaction
			where trans_type between 8000 and 8999
			and trans_owner_type = 0
			and trans_owner_id = :2
			and trans_status = 2
			and Transaction_Type.id = Transaction.trans_type
			order by subtype_sort asc, trans_begin_stamp desc
			
		</statement>

		<statement name="sel_events_worklist_not_today">
			
			select 
			patient.name_last || ', ' || substr(patient.name_first,1,1) as patient,
			ea.value_textB as physician,
			e.facility_id as facility,
			decode(to_char(e.start_time - :1, 'YYYYMMDD'), to_char(sysdate - :1, 'YYYYMMDD'), to_char(e.start_time - :1, 'hh:miam'), to_char(e.start_time - :1, 'MM/DD/YYYY hh:miam')) as appointment_time,
			decode(to_char(e.checkin_stamp - :1, 'YYYYMMDD'), to_char(sysdate - :1, 'YYYYMMDD'), to_char(e.checkin_stamp - :1, 'hh:miam'), to_char(e.checkin_stamp - :1, 'MM/DD/YYYY hh:miam')) as checkin_time,
			decode(to_char(e.checkout_stamp - :1, 'YYYYMMDD'), to_char(sysdate - :1, 'YYYYMMDD'), to_char(e.checkout_stamp - :1, 'hh:miam'), to_char(e.checkout_stamp - :1, 'MM/DD/YYYY hh:miam')) as checkout_time,
			Invoice.invoice_id,
			patient.person_id as patient_id,
			e.event_id,
			Appt_Type.caption as appt_type,
			replace(Appt_Attendee_Type.caption, ' Patient', '') as patient_type,
			Invoice_Status.caption as invoice_status,
			ea.value_intB as flags, o.org_id as facility_name, Invoice.invoice_status as inv_status,
			parent_invoice_id, e.parent_id, Invoice.balance
			from Org o, Invoice_Status, Appt_Attendee_Type, Appt_Type, Invoice, Transaction,
			Person patient, Event_Attribute ea, Event e
			where	
			e.start_time between to_date(:2, 'mm/dd/yyyy hh12:miam') + :1 and to_date(:3, 'mm/dd/yyyy hh12:miam') + :1
			and e.discard_type is null
			and e.event_status in (0,1,2)
			and ea.parent_id = e.event_id
			and ea.value_text = patient.person_id
			and ea.value_type = 333
			and ea.value_textB in (
			select value_text from Person_Attribute
			where parent_id = :4
			and value_type = 250
			and item_name = 'WorkList'
			and parent_org_id = :5
			)
			and e.facility_id in (
			select value_int from Person_Attribute
			where parent_id = :4
			and value_type = 252
			and item_name = 'WorkList'
			and parent_org_id = :5
			)
			and Transaction.parent_event_id(+) = e.event_id
			and Invoice.main_transaction(+) = Transaction.trans_id
			and Appt_Type.appt_type_id (+) = e.appt_type
			and Appt_Attendee_Type.id = ea.value_int
			and Invoice_Status.id(+) = Invoice.invoice_status
			and o.org_internal_id = e.facility_id
			order by 
			e.start_time, e.facility_id, ea.value_text
			
		</statement>

		<statement name="sel_events_worklist_today">
			
			select 
			patient.name_last || ', ' || substr(patient.name_first,1,1) as patient,
			ea.value_textB as physician,
			e.facility_id as facility,
			decode(to_char(e.start_time - :1, 'YYYYMMDD'), to_char(sysdate - :1, 'YYYYMMDD'), to_char(e.start_time - :1, 'hh:miam'), to_char(e.start_time - :1, 'MM/DD/YYYY hh:miam')) as appointment_time,
			decode(to_char(e.checkin_stamp - :1, 'YYYYMMDD'), to_char(sysdate - :1, 'YYYYMMDD'), to_char(e.checkin_stamp - :1, 'hh:miam'), to_char(e.checkin_stamp - :1, 'MM/DD/YYYY hh:miam')) as checkin_time,
			decode(to_char(e.checkout_stamp - :1, 'YYYYMMDD'), to_char(sysdate - :1, 'YYYYMMDD'), to_char(e.checkout_stamp - :1, 'hh:miam'), to_char(e.checkout_stamp - :1, 'MM/DD/YYYY hh:miam')) as checkout_time,
			Invoice.invoice_id,
			patient.person_id as patient_id,
			e.event_id,
			Appt_Type.caption as appt_type,
			replace(Appt_Attendee_Type.caption, ' Patient', '') as patient_type,
			Invoice_Status.caption as invoice_status,
			ea.value_intB as flags, o.org_id as facility_name, Invoice.invoice_status as inv_status,
			parent_invoice_id, e.parent_id, Invoice.balance
			from Org o, Invoice_Status, Appt_Attendee_Type, Appt_Type, Invoice, Transaction,
			Person patient, Event_Attribute ea, Event e
			where	
			e.start_time between sysdate - :6 - (:2/24/60) and sysdate - :6 + (:3/24/60)
			and e.discard_type is null
			and e.event_status in (0,1,2)
			and ea.parent_id = e.event_id
			and ea.value_text = patient.person_id
			and ea.value_type = 333
			and ea.value_textB in (
			select value_text from Person_Attribute
			where parent_id = :4
			and value_type = 250
			and item_name = 'WorkList'
			and parent_org_id = :5
			)
			and e.facility_id in (
			select value_int from Person_Attribute
			where parent_id = :4
			and value_type = 252
			and item_name = 'WorkList'
			and parent_org_id = :5
			)
			and Transaction.parent_event_id(+) = e.event_id
			and Invoice.main_transaction(+) = Transaction.trans_id
			and Appt_Type.appt_type_id (+) = e.appt_type
			and Appt_Attendee_Type.id = ea.value_int
			and Invoice_Status.id(+) = Invoice.invoice_status
			and o.org_internal_id = e.facility_id
			order by 
			e.start_time, e.facility_id, ea.value_text
			
		</statement>

		<statement name="sel_events_worklist_today_byTime">
			
			select 
			patient.name_last || ', ' || substr(patient.name_first,1,1) as patient,
			ea.value_textB as physician,
			e.facility_id as facility,
			decode(to_char(e.start_time - :1, 'YYYYMMDD'), to_char(sysdate - :1, 'YYYYMMDD'), to_char(e.start_time - :1, 'hh:miam'), to_char(e.start_time - :1, 'MM/DD/YYYY hh:miam')) as appointment_time,
			decode(to_char(e.checkin_stamp - :1, 'YYYYMMDD'), to_char(sysdate - :1, 'YYYYMMDD'), to_char(e.checkin_stamp - :1, 'hh:miam'), to_char(e.checkin_stamp - :1, 'MM/DD/YYYY hh:miam')) as checkin_time,
			decode(to_char(e.checkout_stamp - :1, 'YYYYMMDD'), to_char(sysdate - :1, 'YYYYMMDD'), to_char(e.checkout_stamp - :1, 'hh:miam'), to_char(e.checkout_stamp - :1, 'MM/DD/YYYY hh:miam')) as checkout_time,
			Invoice.invoice_id,
			patient.person_id as patient_id,
			e.event_id,
			Appt_Type.caption as appt_type,
			replace(Appt_Attendee_Type.caption, ' Patient', '') as patient_type,
			Invoice_Status.caption as invoice_status,
			ea.value_intB as flags, o.org_id as facility_name, Invoice.invoice_status as inv_status,
			parent_invoice_id, e.parent_id, Invoice.balance
			from Org o, Invoice_Status, Appt_Attendee_Type, Appt_Type, Invoice, Transaction,
			Person patient, Event_Attribute ea, Event e
			where	
			e.start_time between to_date(:2, 'mm/dd/yyyy hh12:miam') + :1 and to_date(:3, 'mm/dd/yyyy hh12:miam') + :1
			and e.discard_type is null
			and e.event_status in (0,1,2)
			and ea.parent_id = e.event_id
			and ea.value_text = patient.person_id
			and ea.value_type = 333
			and ea.value_textB in (
			select value_text from Person_Attribute
			where parent_id = :4
			and value_type = 250
			and item_name = 'WorkList'
			and parent_org_id = :5
			)
			and e.facility_id in (
			select value_int from Person_Attribute
			where parent_id = :4
			and value_type = 252
			and item_name = 'WorkList'
			and parent_org_id = :5
			)
			and Transaction.parent_event_id(+) = e.event_id
			and Invoice.main_transaction(+) = Transaction.trans_id
			and Appt_Type.appt_type_id (+) = e.appt_type
			and Appt_Attendee_Type.id = ea.value_int
			and Invoice_Status.id(+) = Invoice.invoice_status
			and o.org_internal_id = e.facility_id
			order by 
			e.start_time, e.facility_id, ea.value_text
			
		</statement>

		<statement name="sel_patientBalance">
			
			select nvl(sum(balance), 0)
			from invoice
			where client_id = :1
			and invoice_status &gt; 3
			and invoice_status != 15
			and invoice_status != 16
			and invoice_subtype = 0
			and balance &gt; 0
			
		</statement>

		<statement name="sel_populateAppConfirmDialog">
			
			select app_verified_by, app_verify_date, verify_action
			from Sch_Verify where event_id = ?
			
		</statement>

		<statement name="sel_populateInsVerifyDialog">
			
			select * from Sch_Verify where event_id = ?
			
		</statement>

		<statement name="sel_populateMedVerifyDialog">
			
			select med_verified_by, med_verify_date from Sch_Verify where event_id = ?
			
		</statement>

		<statement name="sel_populatePersonalVerifyDialog">
			
			select per_verified_by, per_verify_date from Sch_Verify where event_id = ?
			
		</statement>

		<statement name="sel_verified_events">
			
			select
			to_char(scheduled_stamp, 'MM/DD/YYYY') verification_dates,
			(
			select product_name || ' (Primary)'
			from insurance
			where owner_person_id = :2
			and owner_org_id = :1
			and bill_sequence = 1
			and record_type = 3
			and not ins_type = 7
			) as product_name,
			ea.value_text,
			e.event_id
			from event e, event_attribute ea
			where e.event_id = ea.parent_id
			and (mod(trunc(ea.value_intb / 4), 2) = 1
			or mod(trunc(ea.value_intb / 8), 2) = 1)
			and e.owner_id = :1
			and e.event_status in (0, 1, 2)
			and e.checkin_stamp is not null
			and e.discard_type is null
			and ea.value_text = :2
			order by 1, 2
			
		</statement>

		<statement name="sel_worklist_facilities">
			
			select value_int as facility_id
			from Person_Attribute
			where parent_id = ?
			and value_type = 252
			and item_name = 'WorkList'
			and parent_org_id = ?
			
		</statement>

		<statement name="sel_worklist_resources">
			
			select value_text as resource_id
			from Person_Attribute
			where parent_id = ?
			and value_type = 250
			and item_name = ?
			and parent_org_id = ?
			
		</statement>

	</sql-statements>
</xaf>