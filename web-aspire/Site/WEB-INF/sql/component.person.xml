<?xml version="1.0"?>

<xaf>
	<sql-statements package="component.person">
		<statement name="id">
			App::Statements::Component::Person
		</statement>

		<statement name="person.account-notes">
			
			SELECT * FROM (
			select to_char(trans_begin_stamp -:2, 'MM/DD/YYYY'),
			detail, trans_id, trans_type, provider_id
			from transaction
			where trans_owner_id = :1
			and trans_status = 2
			and trans_type = 9500
			order by trans_id desc
			)
			WHERE ROWNUM &lt; 11
			
		</statement>

		<statement name="person.accountPanel">
			
			SELECT
			i.invoice_id,
			i.client_id,
			i.owner_id,
			i.submitter_id,
			i.invoice_date,
			i.total_cost,
			i.balance,
			ib.bill_to_id,
			(
			SELECT 	b.org_id
			FROM org b
			WHERE b.org_internal_id = ib.bill_to_id
			AND ib.bill_party_type not in(0,1)
			) AS org_id,
			ib.bill_party_type
			FROM invoice i, invoice_billing ib
			WHERE i.client_id = ?
			AND ib.invoice_id = i.invoice_id
			AND ib.bill_sequence = 1
			AND ib.invoice_item_id is NULL
			AND i.balance &gt; 0
			ORDER BY i.invoice_date
			
		</statement>

		<statement name="person.activeMedications">
			
			SELECT
			permed_id,
			med_name,
			dose,
			dose_units,
			TO_CHAR(start_date, 'IYYYMMDD') as start_date,
			frequency,
			num_refills,
			approved_by
			FROM
			Person_Medication
			WHERE
			parent_id = ? AND
			(end_date IS NULL OR end_date &gt;= TRUNC(sysdate))
			ORDER BY
			start_date DESC,
			med_name
			
		</statement>

		<statement name="person.activeMedicationsOld">
			
			SELECT
			tr.trans_type,
			tr.trans_id,
			tr.caption,
			decode(to_char(tr.trans_begin_stamp, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(tr.trans_begin_stamp, 'Mon DD'), to_char(tr.trans_begin_stamp, 'MM/DD/YY')),
			tt.caption,
			tr.provider_id,
			tr.data_text_a
			FROM
			transaction tr,
			transaction_type tt
			WHERE
			tr.trans_type BETWEEN 7000 AND 7999
			AND tr.trans_type = tt.id
			AND tr.trans_owner_type = 0
			AND tr.trans_owner_id = ?
			AND tr.trans_status = 2
			ORDER BY tr.trans_begin_stamp DESC
			
		</statement>

		<statement name="person.activeProblems">
			
			select 0 as GROUP_SORT, decode(to_char(sysdate, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(sysdate, 'Mon DD'), to_char(sysdate, 'MM/DD/YY')) as curr_onset_date, 'Claims in progress: ' || count(invoice_id), '' as provider_id, 11 as trans_type, 111 as trans_id, '' as code
			from invoice where invoice_type = 0 and invoice_status &lt; 3 and client_id = ?
			UNION ALL
			select 1 as GROUP_SORT, decode(to_char(sysdate, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(sysdate, 'Mon DD'), to_char(sysdate, 'MM/DD/YY')) as curr_onset_date, '-', '-', -1 as trans_type, -1 as trans_id, '' as code
			from dual
			UNION ALL
			select 	2 as GROUP_SORT, decode(to_char(trans_begin_stamp, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(trans_begin_stamp, 'Mon DD'), to_char(trans_begin_stamp, 'MM/DD/YY')) as curr_onset_date, data_text_a, provider_id, trans_type, trans_id, '' as code
			from 	transaction
			where 	trans_type = 3100 and trans_owner_id = ?
			and 	trans_status = 2
			UNION ALL
			select	2 as GROUP_SORT, decode(to_char(t.curr_onset_date, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(t.curr_onset_date, 'Mon DD'), to_char(t.curr_onset_date, 'MM/DD/YY')) as curr_onset_date, ref.descr, provider_id, trans_type, trans_id, '(ICD ' || t.code || ')' as code
			from 	transaction t, ref_icd ref
			where 	trans_type = 3020
			and 	trans_owner_type = 0 and trans_owner_id = ?
			and 	t.code = ref.icd (+)
			and 	trans_status = 2
			UNION ALL
			select	2 as GROUP_SORT, decode(to_char(curr_onset_date, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(curr_onset_date, 'Mon DD'), to_char(curr_onset_date, 'MM/DD/YY')), data_text_a, provider_id, trans_type, trans_id, '' as code
			from 	transaction
			where 	trans_type between 3000 and 3010
			and 	trans_owner_id = ?
			and 	trans_status = 2
			order by GROUP_SORT, curr_onset_date DESC
			
		</statement>

		<statement name="person.additionalData">
			
			select item_name, value_text, value_type, item_id
			from 	person_attribute
			where	parent_id = ?
			and 	value_type = 820
			
		</statement>

		<statement name="person.addresses">
			
			SELECT
			address_name,
			complete_addr_html,
			item_id
			FROM Person_address
			WHERE parent_id = ?
			ORDER BY address_name

		</statement>

		<statement name="person.advancedDirectives">
			
			select 	value_type, item_id, decode(to_char(value_date, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(value_date, 'Mon DD'), to_char(value_date, 'MM/DD/YY')), item_name
			from 	person_attribute
			where 	parent_id = ?
			and 	value_type in (420, 421)
			
		</statement>

		<statement name="person.affiliations">
			
			select 	value_type, item_id, item_name, value_text, decode(to_char(value_dateend, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(value_dateend, 'Mon DD'), to_char(value_dateend, 'MM/DD/YY'))
			from 	person_attribute
			where 	parent_id = ?
			and 	value_type = 530
			
		</statement>

		<statement name="person.alerts">
			
			SELECT
			t.caption,
			detail,
			trans_type,
			trans_id,
			trans_subtype,
			decode(to_char(trans_end_stamp, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(trans_end_stamp, 'Mon DD'), to_char(trans_end_stamp, 'MM/DD/YY')) as value_dateend,
			(
			SELECT
			trans_type
			FROM person_attribute p
			WHERE p.item_id = t.data_text_b
			AND t.trans_type = 8040
			) AS type
			FROM alert_priority a, transaction t
			WHERE trans_type between 8000 and 8999
			AND trans_owner_type = 0
			AND trans_owner_id = :1
			AND trans_status = 2
			AND a.caption = t.trans_subtype
			AND NOT EXISTS (
			SELECT tt.trans_end_stamp
			FROM transaction tt, person_attribute pa
			WHERE tt.trans_id = t.trans_id
			AND tt.trans_end_stamp &gt; sysdate + 90
			AND tt.data_text_b = pa.item_id
			AND tt.trans_type = 8040
			)
			ORDER BY a.id desc, trans_begin_stamp desc
			
		</statement>

		<statement name="person.allMedications">
			
			SELECT
			permed_id,
			med_name,
			dose,
			dose_units,
			TO_CHAR(start_date, 'IYYYMMDD') as start_date,
			frequency,
			num_refills,
			approved_by,
			TO_CHAR(end_date, 'IYYYMMDD') as end_date
			FROM
			Person_Medication
			WHERE
			parent_id = ?
			ORDER BY
			start_date DESC,
			med_name
			
		</statement>

		<statement name="person.allergies">
			
			select 	value_type, item_id,item_name, value_text
			from 	person_attribute
			where 	parent_id = ?
			and 	value_type in (410, 411, 412)
			
		</statement>

		<statement name="person.appointmentCount">
			
			SELECT
			count(e.discard_type),
			DECODE(d.caption, 'Patient Reschedule','Reschedule', d.caption)
			FROM event e, event_attribute ea, Appt_Discard_Type d, person p
			WHERE Ea.value_text = p.person_id
			AND p.person_id = ?
			AND ea.parent_id = e.event_id
			AND d.id = e.discard_type
			GROUP BY d.caption
			
		</statement>

		<statement name="person.associatedResources">
			
			select 	value_type, item_id, item_name, value_text
			from 	person_attribute
			where 	parent_id = ?
			and 	value_type = 250
			and item_name = 'Physician'
			
		</statement>

		<statement name="person.associatedSessionPhysicians">
			
			select value_text as resource_id
			from Person_Attribute
			where parent_id = :1
			and value_type = 250
			and item_name = 'WorkList'
			and parent_org_id = :2
			order by 1
			
		</statement>

		<statement name="person.attendance">
			
			select 	value_type, item_id, item_name, value_text
			from 	person_attribute
			where 	parent_id = ?
			and 	value_type = 800
			
		</statement>

		<statement name="person.authorization">
			
			select value_type, item_id, item_name, value_text, decode(to_char(value_date, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(value_date, 'Mon DD'), to_char(value_date, 'MM/DD/YY'))
			from 	person_attribute
			where	parent_id = ?
			and 	value_type in (
			370,
			371,
			372
			)
			
		</statement>

		<statement name="person.benefits">
			
			select 	value_type, item_id, item_name, value_text
			from 	person_attribute
			where 	parent_id = ?
			and 	value_type in (700, 710, 720)
			
		</statement>

		<statement name="person.billinginfo">
			
			select value_type, item_id, value_text, decode(to_char(value_date, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(value_date, 'Mon DD'), to_char(value_date, 'MM/DD/YY')),
			decode(value_int, 0,'Per-Se', 2,'THINet', 'Other'),
			decode(value_intb, '1','Active', 'Inactive')
			from	person_attribute
			where	parent_id = ?
			and	value_type = 960
			order by value_int
			
		</statement>

		<statement name="person.bloodType">
			
			SELECT
			value_type,
			item_id,
			parent_id,
			item_name,
			DECODE(value_text, '', 'Unknown', (
			SELECT b.caption
			FROM blood_type b
			WHERE b.id = p.value_text
			)
			) AS caption
			FROM Person_Attribute p
			WHERE 	parent_id = ?
			AND item_name = 'BloodType'
			
		</statement>

		<statement name="person.bookmarks">
			
			select value_text, value_textb, parent_id, item_id
			from person_attribute
			where parent_id = :1
			and item_name = 'Bookmarks'
			
		</statement>

		<statement name="person.careProviders">
			
			select
			p.value_type,
			p.item_id,
			p.item_name,
			p.value_text,
			p.value_textb,
			p.parent_id,
			decode(p.value_int,1,', Primary Physician', ''),
			pc.category
			from 	person_org_category pc, person_attribute p
			where p.parent_id = upper(:1)
			and p.value_type = 210
			and pc.person_id = p.value_text
			and pc.org_internal_id = :2
			and pc.category in ('Physician', 'Referring-Doctor')
			
		</statement>

		<statement name="person.certification">
			
			select 	value_type, item_id, item_name, value_text, decode(to_char(value_dateend, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(value_dateend, 'Mon DD'), to_char(value_dateend, 'MM/DD/YY')),
			(select (decode(a.value_int,5,'Unknown',1,'Primary',2,'Secondary',3,'Tertiary',4,'Quaternary'))
			from person_attribute a where a.value_type in (540) and a.item_id = b.item_id)value_int,
			name_sort,
			decode(sign(value_dateend - sysdate), -1, 'Inactive', 'Active'),
			decode(to_char(value_date, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(value_date, 'Mon DD'), to_char(value_date, 'MM/DD/YY'))
			from 	person_attribute b
			where 	parent_id = ?
			and 	value_type in (500, 510, 520, 540, 550, 560)
			and item_name not in('Nurse/Title', 'RN', 'Driver/License', 'Employee')
			order by value_int
			
		</statement>

		<statement name="person.childReferral">
			
			SELECT 	tr.trans_id,
			to_char(tr.data_date_a,'MM/DD/YY'),
			(SELECT rsd.name
			FROM ref_service_category rsd , transaction tp
			WHERE rsd.serv_category = tsr.trans_expire_reason
			AND	tp.trans_id = tsr.parent_trans_id),
			(SELECT caption FROM referral_followup_status where id = tr.trans_status_reason),
			to_char(tr.data_date_b,'MM/DD/YY'),
			tr.trans_type,
			(SELECT parent_trans_id FROM transaction where trans_id = tr.parent_trans_id)
			FROM transaction tsr, transaction tr
			WHERE tsr.parent_trans_id = :1
			AND	tr.parent_trans_id = tsr.trans_id
			ORDER BY 1 desc
			
		</statement>

		<statement name="person.clinical">
			
			select 	value_type, item_id, item_name, value_text
			from 	person_attribute
			where 	parent_id = ?
			and 	value_type = 111111
			
		</statement>

		<statement name="person.contactMethods">
			
			SELECT
			value_int,
			value_type,
			item_name,
			value_text,
			item_id,
			'attr-Person-' AS dialogid_suffix
			FROM Person_Attribute
			WHERE
			parent_id = ?
			AND	value_type IN (
			10,
			15,
			20,
			40,
			50,
			25
			)
			ORDER BY
			value_type,
			name_sort,
			item_name

		</statement>

		<statement name="person.contactMethodsAndAddresses">
			
			SELECT
			value_int AS preferred,
			value_type,
			value_text || ' (' || item_name || ')',
			item_id,
			avt.caption AS caption,
			'attr-Person-' || value_type AS dialogid_suffix
			FROM
			Person_attribute,
			attribute_value_type avt
			WHERE
			parent_id = ?
			AND	value_type IN (
			10,
			15,
			20,
			40,
			50,
			25
			)
			AND	avt.id = value_type
			UNION ALL (
			SELECT
			0 as preferred,
			99998 AS value_type,
			'-' AS value_text,
			-1,
			'-',
			'-'
			FROM dual
			)
			UNION ALL (
			SELECT
			0 AS preferred,
			99910 AS value_type,
			complete_addr_html AS value_text,
			item_id,
			address_name AS caption,
			DECODE('Person', 'Person', 'attr-person-', 'Org', 'attr-org-' ) || 99910 AS dialogid_suffix
			FROM Person_address
			WHERE parent_id = ?
			)
			ORDER BY value_type

		</statement>

		<statement name="person.diagnosisSummary">
			
			select member_name as code, name as description, to_char(min(trans_begin_stamp), 'mm/dd/yyyy') as earliest_date,
			to_char(max(trans_begin_stamp), 'mm/dd/yyyy') as latest_date, count(member_name) as num_times
			from ref_icd, invoice_claim_diags,transaction, invoice
			where client_id = ?
			and trans_id = main_transaction
			and invoice_claim_diags.parent_id = invoice.invoice_id
			and ref_icd.icd (+) = member_name
			group by member_name, name
			
		</statement>

		<statement name="person.docPhone">
			
			select trans_id, trans_owner_id, trans_type, decode(trans_status,4,'Read',5,'Not Read'), caption, provider_id, decode(to_char(trans_begin_stamp, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(trans_begin_stamp, 'Mon DD'), to_char(trans_begin_stamp, 'MM/DD/YY')), data_text_a, data_text_b, consult_id,complete_name
			from Transaction,person
			where trans_owner_id = ?
			and caption = 'Phone Message'
			and data_num_a is not null
			and trans_status = 5
			and person.person_id = consult_id
			
		</statement>

		<statement name="person.docRefill">
			
			select 	trans_id, trans_owner_id, trans_type, decode(trans_status,7,'Filled',6,'Pending'), caption,
			provider_id, decode(to_char(trans_begin_stamp, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(trans_begin_stamp, 'Mon DD'), to_char(trans_begin_stamp, 'MM/DD/YY')), data_text_a, data_text_b, processor_id, receiver_id,
			person.complete_name
			from Transaction,person
			where 	trans_owner_id = ?
			and caption = 'Refill Request'
			and data_num_a is null
			and processor_id = person_id
			union
			select 	trans_id, trans_owner_id, trans_type, decode(trans_status,7,'Filled',6,'Pending'), caption,
			provider_id, decode(to_char(trans_begin_stamp, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(trans_begin_stamp, 'Mon DD'), to_char(trans_begin_stamp, 'MM/DD/YY')), data_text_a, data_text_b, processor_id, receiver_id,
			person.complete_name
			from Transaction, person
			where trans_owner_id = ?
			and caption = 'Refill Request'
			and data_num_a is not null
			and processor_id = person_id
			and trans_status = 6
			
		</statement>

		<statement name="person.docResults">
			
			select 	'Ms Cindy Crawford',to_char(sysdate,'Mon-DD'), 'Lab','CBC' ,'CCRAWFORD','Abnormal' FROM DUAL
			UNION
			select 	'GEORGE SCHMIDT' ,to_char(sysdate,'Mon-DD'),'X-Ray','Chest-Xray', 'GSCHMIDT','Normal' FROM DUAL
			
		</statement>

		<statement name="person.docSign">
			
select 'NOT IMPLEMENTED' from dual
			
		</statement>

		<statement name="person.emergencyAssociations">
			
			select 	value_type, item_id, item_name,
			(select p.person_id
			from person p
			where p.person_id = b.value_text)person_id, value_textb,
			(select a.value_text
			from person_attribute a
			where a.value_int = 0
			and a.item_id = b.item_id)value_text
			from 	person_attribute b
			where	parent_id = ?
			and 	value_type = 201
			and 	item_name not in( 'Guarantor', 'Responsible Party')
			
		</statement>

		<statement name="person.employmentAssociations">
			
			select	pa.value_type, pa.item_id, pa.item_name, pa.value_text, avt.caption
			from 	person_attribute pa, attribute_value_type avt
			where	pa.parent_id = ?
			and	pa.value_type = avt.id
			and pa.value_type between 220 and 227
			
		</statement>

		<statement name="person.employmentRecord">
			
			select 	value_type, item_id, item_name, value_text
			from 	person_attribute
			where 	parent_id = ?
			and 	value_type = 810
			
		</statement>

		<statement name="person.extendedHealthCoverage">
			
			SELECT 	decode(bill_sequence, 1,'Primary',2,'Secondary',3,'Tertiary',4,'Quaternary',5,'W. Comp', 98, 'Terminated', 99, 'InActive'),
			decode(ins_type,0,'Self-Pay',1,'Insurance',2,'HMO',3,'PPO',4,'Medicare',5,'Medicaid',6,'W.Comp',7,'Client Billing',8,'Champus',9,'ChampVA',10,
			'FECA Blk Lung',11,'BCBS'),
			member_number,
			ins_internal_id,
			record_type,
			plan_name,
			policy_number,
			copay_amt,
			coverage_end_date,
			ins_org_id,
			product_name,
			(
			SELECT 	b.org_id
			FROM org b
			WHERE b.org_internal_id = i.ins_org_id
			) AS org_id,
			guarantor_id,
			guarantor_name,
			guarantor_type,
			(
			SELECT 	b.org_id
			FROM org b
			WHERE b.org_internal_id = i.ins_org_id
			) AS org_id,
			(
			SELECT 	g.org_id
			FROM org g
			WHERE guarantor_type = 1
			AND g.org_internal_id = i.guarantor_id
			),
			i.coverage_begin_date
			FROM 	insurance i
			WHERE 	owner_person_id = ?
			ORDER BY bill_sequence
			
		</statement>

		<statement name="person.familyAssociations">
			
			select 	value_type, item_id, item_name,
			(select p.person_id
			from person p
			where p.person_id = b.value_text)person_id, value_textb,
			(select a.value_text
			from person_attribute a
			where a.value_int = 0
			and a.item_id = b.item_id)value_text
			from 	person_attribute b
			where	parent_id = ?
			and	value_type = 200
			
		</statement>

		<statement name="person.feeschedules">
			
SELECT	oc.catalog_id,
			oc.caption,
			oc.description,
			oc.internal_catalog_id,
			pa.item_id
			FROM person_attribute pa,
			offering_catalog oc
			WHERE pa.parent_id = :1
			AND	pa.item_name = 'Fee Schedule'
			AND	pa.item_type = 0
			AND	pa.value_type = 110
			AND	pa.value_int = oc.internal_catalog_id
			ORDER BY oc.catalog_id
			
		</statement>

		<statement name="person.group-account-notes">
			
			select complete_name, count (*) as count, min(trans_begin_stamp),max(trans_begin_stamp),
			trans_owner_id
			from transaction, person
			where provider_id = ? and
			trans_owner_id = person_id and
			trans_status = 2 and
			trans_type = 9500
			group by complete_name,trans_owner_id
			
		</statement>

		<statement name="person.hospitalizationSurgeriesTherapies">
			
			select decode(to_char(trans_begin_stamp, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(trans_begin_stamp, 'Mon DD'), to_char(trans_begin_stamp, 'MM/DD/YY')), org.name_primary, org.org_id, provider_id, caption, data_num_a, detail, data_text_c,
			trans_type, trans_id, decode(to_char(trans_end_stamp, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(trans_end_stamp, 'Mon DD'), to_char(trans_end_stamp, 'MM/DD/YY')), auth_ref, data_text_a, data_text_b
			from 	org, transaction
			where 	trans_type between 11000 and 11999
			and 	trans_owner_id = ?
			and 	trans_status = 2
			and service_facility_id = org.org_internal_id
			
		</statement>

		<statement name="person.inPatient">
			
			select t.trans_owner_id , t.caption as room_number, initcap(p.short_sortable_name)
			as simple_name, t.consult_id, o.name_primary, decode(to_char(t.trans_begin_stamp - :3, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(t.trans_begin_stamp - :3, 'Mon DD'), to_char(t.trans_begin_stamp - :3, 'MM/DD/YY'))
			as admit_date, data_num_a
			FROM org o, person p, transaction t
			WHERE
			t.trans_type BETWEEN 11000 AND 11999
			AND	t.provider_id = :1
			AND p.person_id = t.trans_owner_id
			AND t.trans_status = 2
			AND t.trans_begin_stamp &gt;= to_date(:2, 'MM/DD/YYYY') - data_num_a
			AND o.org_internal_id = t.service_facility_id
			ORDER by p.name_last
			
		</statement>

		<statement name="person.inactiveMedications">
			
			SELECT
			permed_id,
			med_name,
			dose,
			dose_units,
			route,
			frequency,
			TO_CHAR(start_date, 'IYYYMMDD') as start_date,
			TO_CHAR(end_date, 'IYYYMMDD') as end_date,
			notes
			FROM
			Person_Medication
			WHERE
			parent_id = ? AND
			end_date &lt; TRUNC(sysdate)
			ORDER BY
			start_date DESC,
			med_name
			
		</statement>

		<statement name="person.insurance">
			
			SELECT
			ins_internal_id,
			parent_ins_id,
			product_name,
			DECODE(record_type, 3, 'coverage') AS record_type,
			plan_name,
			DECODE(bill_sequence,1,'Primary',2,'Secondary',3,'Tertiary',4,'Quaternary',5,'W. Comp', 98, 'Terminated', 99, 'InActive', 'Active'),
			owner_person_id,
			ins_org_id,
			indiv_deductible_amt,
			family_deductible_amt,
			percentage_pay,
			copay_amt,
			guarantor_name,
			decode(ins_type, 7, 'thirdparty', 'coverage') AS ins_type,
			guarantor_id,
			guarantor_type,
			(
			SELECT 	b.org_id
			FROM org b
			WHERE b.org_internal_id = i.ins_org_id
			) AS org_id,
			(
			SELECT 	g.org_id
			FROM org g
			WHERE guarantor_type = 1
			AND g.org_internal_id = i.guarantor_id
			),
			i.coverage_begin_date,
			i.coverage_end_date
			FROM insurance i
			WHERE record_type = 3
			AND owner_person_id = ?
			ORDER BY bill_sequence
			
		</statement>

		<statement name="person.insuranceVerify">
			
			SELECT * FROM (
			select s.event_id, s.person_id, s.ins_verified_by, 
			to_char(s.ins_verify_date, 'MM/DD/YYYY') as verify_date,
			to_char(e.start_time, 'MM/DD/YYYY HH12:MI AM') as appt_time,
			o.org_id, ea.value_textb as provider_id
			from event_attribute ea, org o, event e, sch_verify s
			where person_id = :1
			and e.event_id = s.event_id
			and o.org_internal_id = e.facility_id
			and ea.parent_id = e.event_id
			order by ins_verify_date DESC
			)
			WHERE ROWNUM &lt; 11
			
		</statement>

		<statement name="person.labOrderDetail">
			
			Select	lo.lab_order_id,lo.date_order,lo.provider_id, los.caption
			FROM	org ,person_lab_order lo, lab_order_status los
			WHERE 	owner_org_id= :1
			AND	lo.lab_internal_id = org.org_internal_id
			AND 	lo.lab_internal_id = :2
			AND	lo.person_id = :3
			AND	los.id = lo.lab_order_status
			order by date_order desc
			
		</statement>

		<statement name="person.labOrderSummary">
			
			Select	org_id,name_primary,org_internal_id,
			(SELECT count (*)
			FROM 	person_lab_order lo
			WHERE 	lo.person_id = :2
			AND	lo.lab_internal_id = org.org_internal_id
			) as entry
			FROM	org ,ORG_CATEGORY oc
			WHERE 	owner_org_id= :1
			AND	oc.parent_id = org.org_internal_id
			AND	oc.member_name='Ancillary Service'
			order by org_id
			
		</statement>

		<statement name="person.linkMedicalSite">
			
			select 'PDR NET','Meidical Reference Information','http://physician.pdr.net/physician/index.htm',to_number(NULL) as item_id FROM dual
			UNION
			SELECT 	value_text,value_textb,name_sort,item_id FROM person_attribute
			WHERE 	parent_id = ?
			AND	item_name = 'User/Link/Medical'
			
		</statement>

		<statement name="person.linkNonMedicalSite">
			
			SELECT 'CNN','News And Information','http://www.cnn.com',to_number(NULL) as item_id FROM dual
			UNION
			SELECT 	value_text,value_textb,name_sort,item_id FROM person_attribute
			WHERE 	parent_id = ?
			AND	item_name = 'User/Link/NonMedical'
			
		</statement>

		<statement name="person.messageCounts">
			
SELECT doc_spec_subtype, count(*)
			FROM document, document_attribute
			WHERE document_attribute.value_text = :1
			AND document.doc_spec_type = 2000
			AND document.doc_id = document_attribute.parent_id
			AND document_attribute.item_name IN ('To', 'CC')
			AND document_attribute.value_int = 0
			AND document.cr_org_internal_id = :2
			GROUP BY document.doc_spec_subtype
			union
			SELECT '-1' as doc_spec_subtype,count (*)
			FROM	observation
			WHERE	observation.observer_org_id = :2
			AND	observation.observer_id = :1
			group by 1
			
		</statement>

		<statement name="person.messageRegardingPatient">
			
			SELECT * FROM (
			select d.doc_name, to_char(d.doc_orig_stamp - :2, 'MM/DD/YYYY HH12:MI AM')
			as doc_orig_stamp, d.doc_source_id, d.doc_dest_ids, d.doc_spec_subtype,
			d.doc_id
			from document d, document_attribute da
			where da.item_name = 'Regarding Patient'
			and da.value_text = :1
			and d.doc_id = da.parent_id
			order by d.doc_orig_stamp DESC
			)
			WHERE ROWNUM &lt; 11
			
		</statement>

		<statement name="person.miscNotes">
			
			SELECT
			value_type,
			item_id,
			parent_id,
			item_name,
			value_text,
			decode(to_char(value_date, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(value_date, 'Mon DD'), to_char(value_date, 'MM/DD/YY')),
			value_textB
			from Person_Attribute
			where 	parent_id = ?
			and item_name = 'Misc Notes'
			
		</statement>

		<statement name="person.myAssociatedResourceAppointments">
			
			select to_char(e.start_time - :1, 'hh:miam') as start_time,
			ea.value_textB as resource_id,
			patient.simple_name as patient_complete_name,
			e.subject,
			at.caption as appt_type,
			aat.caption as patient_type,
			e.remarks,
			ea.value_text as patient_id,
			e.event_id, patient.person_id
			from 	Appt_Status, Appt_Attendee_type aat, Person patient, Person provider,
			Event_Attribute ea, Appt_Type at, Event e
			where e.start_time between to_date(:2, 'MM/DD/YYYY HH12:MI AM') + :1
			and to_date(:3, 'MM/DD/YYYY HH12:MI AM') + :1
			and e.discard_type is null
			and e.event_status in (0,1,2)
			and at.appt_type_id (+) = e.appt_type
			and ea.parent_id = e.event_id
			and ea.value_type = 333
			and ea.value_text = patient.person_id
			and ea.value_textB = provider.person_id
			and
			(	ea.value_textB = :4 or
			ea.value_textB in
			(select value_text
			from person_attribute
			where parent_id = :4
			and item_name = 'WorkList'
			and value_type = 250
			and parent_org_id = :5
			)
			)
			and aat.id = ea.value_int
			and Appt_Status.id = e.event_status
			order by e.start_time
			
		</statement>

		<statement name="person.myAssociatedResourceInPatients">
			
			SELECT
			decode(to_char(trans_begin_stamp - :1, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(trans_begin_stamp - :1, 'Mon DD'), to_char(trans_begin_stamp - :1, 'MM/DD/YY')),
			initcap(simple_name) as simple_name,
			provider_id,
			caption as room_number,
			data_num_a as duration_days,
			detail as diags,
			data_text_c as procedures,
			data_text_a,
			consult_id,
			trans_id,
			trans_type,
			trans_owner_id,
			org.name_primary
			FROM
			org,
			transaction,
			person
			WHERE
			trans_type BETWEEN 11000 AND 11999 AND
			person_id = trans_owner_id AND
			(
			provider_id = :2 OR provider_id IN
			(
			SELECT value_text
			FROM person_attribute
			WHERE parent_id = :2
			AND value_type = 250
			AND item_name = 'WorkList'
			AND parent_org_id = :3
			)
			) AND
			trans_status = 2
			AND (SYSDATE - trans_begin_stamp) &lt;= data_num_a
			AND org.org_internal_id = transaction.service_facility_id
			ORDER BY trans_begin_stamp DESC
			
		</statement>

		<statement name="person.mySessionActivity">
			
			select to_char(pa.activity_stamp - :1 - :3, 'MM/DD/YYYY HH12:MI AM') as activity_stamp,
			sat.caption as caption,
			pa.activity_data as data,
			pa.action_scope as scope,
			pa.action_key as action_key
			from Session_Action_Type sat, perSess_Activity pa
			where pa.person_id = :2
			and	pa.activity_stamp &gt;= trunc(sysdate) + :1 + :3
			and	sat.id = pa.action_type
			and 10 &gt; (
			select count(*) from perSess_Activity pa2
			where pa.activity_stamp &lt; pa2.activity_stamp
			and pa.person_id = pa2.person_id
			)
			order by pa.activity_stamp desc
			
		</statement>

		<statement name="person.officeLocation">
			
			SELECT 	value_type, item_id, parent_id, item_name, value_text, value_textB, value_int, name_primary
			from Person_Attribute, Org
			where 	parent_id = ?
			AND value_text = org_id
			AND item_name = 'Office Location'
			
		</statement>

		<statement name="person.patientAppointments">
			
			select 	decode(to_char(e.start_time - :1, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(e.start_time - :1, 'Mon DD'), to_char(e.start_time - :1, 'MM/DD/YY')),
			to_char(e.start_time - :1, 'HH12:MI AM'),
			ea.value_textB,
			e.subject,
			to_char(e.start_time - :1, 'MM-DD-YYYY'),
			1 as group_sort,
			e.start_time as apptdate
			from Event_Attribute ea, Event e
			where ea.parent_id = e.event_id
			and ea.value_type = 333
			and ea.value_text = :2
			and e.event_status != 3
			and e.start_time &gt; sysdate
			UNION
			select 	decode(to_char(sysdate - :1, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(sysdate - :1, 'Mon DD'), to_char(sysdate - :1, 'MM/DD/YY')),
			to_char(sysdate - :1, 'HH12:MI AM'),
			'-',
			'-',
			to_char(sysdate - :1, 'MM-DD-YYYY'),
			2 as group_sort,
			trunc(sysdate) as apptdate
			from DUAL
			UNION
			select 	decode(to_char(e.start_time - :1, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(e.start_time - :1, 'Mon DD'), to_char(e.start_time - :1, 'MM/DD/YY')),
			to_char(e.start_time - :1, 'HH12:MI AM'),
			ea.value_textB,
			e.subject,
			to_char(e.start_time - :1, 'MM-DD-YYYY'),
			3 as group_sort,
			e.start_time as apptdate
			from Event_Attribute ea, Event e
			where ea.parent_id = e.event_id
			and ea.value_type = 333
			and ea.value_text = :2
			and e.event_status != 3
			and e.start_time &lt; sysdate
			and 10 &gt; (select count(*) from Event_Attribute ea2, Event e2
			where ea2.parent_id = e2.event_id
			and ea2.value_text = ea.value_text
			and ea2.value_type = 333
			and e.start_time &lt; e2.start_time
			and e2.event_status != 3
			and e2.start_time &lt; sysdate
			)
			ORDER by group_sort, apptdate DESC
			
		</statement>

		<statement name="person.patientInfo">
			
			SELECT
			UNIQUE person_id,
			ssn,
			date_of_birth,
			simple_name,
			g.caption
			FROM	person p, transaction t, gender g
			WHERE trans_type in (6000, 6010)
			AND consult_id = ?
			AND 	 p.person_id = t.consult_id
			AND 	 g.id = p.gender
			
		</statement>

		<statement name="person.personCategory">
			
			select 	p.simple_name, pa.category, pa.person_id, pa.org_internal_id
			from 	person_org_category pa, person p
			where	 p.person_id = ?
			and pa.org_internal_id = ?
			and pa.category in ('Patient', 'Guarantor','Insured-Person')
			and	p.person_id = pa.person_id
			order by pa.category
			
		</statement>

		<statement name="person.phoneMessage">
			
			select trans_id, trans_owner_id, trans_type, decode(trans_status,4,'Read',5,'Not Read'),
			caption, provider_id, data_text_c, data_text_a, data_text_b, cr_user_id, consult_id
			from Transaction
			where trans_owner_id = ?
			and caption = 'Phone Message'
			and data_num_a is null
			UNION
			select trans_id, trans_owner_id, trans_type, decode(trans_status,4,'Read',5,'Not Read'),
			caption, provider_id, data_text_c, data_text_a, data_text_b, cr_user_id, consult_id
			from Transaction
			where trans_owner_id = ?
			and caption = 'Phone Message'
			and data_num_a is not null
			and trans_status = 5
			and trans_owner_id &lt;&gt; consult_id
			
		</statement>

		<statement name="person.preventiveCare">
			
			select 	value_type, item_id, item_name, decode(to_char(value_date, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(value_date, 'Mon DD'), to_char(value_date, 'MM/DD/YY')), decode(to_char(value_dateend, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(value_dateend, 'Mon DD'), to_char(value_dateend, 'MM/DD/YY')), value_text, value_textb
			from 	person_attribute
			where 	parent_id = ?
			and 	value_type = 400
			
		</statement>

		<statement name="person.recentlyVisitedPatients">
			
			select p.simple_name, pvc.view_key from PerSess_View_Count pvc,
			person p , Person_Org_Category pog
			where p.person_id = pvc.view_key AND pvc.person_id = :2 and
			pog.person_id = p.person_id AND pog.category = 'Patient'
			and	pvc.view_latest &gt;= trunc(sysdate) + :1
			order by pvc.view_latest desc
			
		</statement>

		<statement name="person.referralAndIntake">
			
			SELECT 	trans_id,
			to_char(data_date_a,'MM/DD/YY'),
			(SELECT to_char(data_date_a,'MM/DD/YY') FROM transaction where trans_id = t.parent_trans_id),
			(
			SELECT rsd.name
			FROM ref_service_category rsd, transaction t1 where t1.trans_id = t.parent_trans_id
			AND t1.trans_expire_reason = rsd.SERV_CATEGORY
			),
			to_char(data_date_b,'MM/DD/YY'),
			(SELECT caption FROM referral_followup_status where id = trans_status_reason),
			trans_type,
			(SELECT parent_trans_id FROM transaction where trans_id = t.parent_trans_id),
			(SELECT to_char(t2.trans_end_stamp,'MM/DD/YY') FROM transaction t1, transaction t2 WHERE t1.trans_id = t.parent_trans_id
			AND	t2.trans_id = t1.parent_trans_id),
			(SELECT to_char(data_date_b,'MM/DD/YY') FROM transaction where trans_id = t.parent_trans_id)
			FROM transaction t
			WHERE 	consult_id = ?
			AND trans_type in (6010)
			ORDER BY 3 desc
			
		</statement>

		<statement name="person.referralAndIntakeCount">
			
			SELECT
			(COUNT(trans_id)-COUNT(parent_trans_id)) AS service_request,
			COUNT(parent_trans_id) AS referral
			FROM transaction
			WHERE 	consult_id = ?
			AND trans_type in (6000, 6010)
			
		</statement>

		<statement name="person.refillRequest">
			
			SELECT count(*)
			FROM document, document_attribute
			WHERE document_attribute.value_text = :1
			AND document.doc_spec_type = 2000
			AND document.doc_id = document_attribute.parent_id
			AND document_attribute.item_name IN ('To', 'CC')
			AND document_attribute.value_int = 0
			AND doc_spec_subtype = 2
			
		</statement>

		<statement name="person.scheduleAppts">
			
			SELECT p.person_id, to_char(e.start_time - :1, 'hh:miam') as start_time,
			a.caption, e.subject as visit, org_id, initcap(p.short_sortable_name) as simple_name
			FROM appt_status a, org, person p, event_attribute ePhy, event e
			WHERE e.start_time &gt;= to_date(:3, 'MM/DD/YYYY') + :1
			AND e.start_time &lt; to_date(:3, 'MM/DD/YYYY') + :1 + 1
			AND e.event_status &lt; 3
			AND ePhy.parent_id = e.event_id
			AND ePhy.item_name = 'Appointment'
			AND ePhy.value_textB = :2
			AND p.person_id = ePhy.VALUE_TEXT
			AND org.org_internal_id = e.facility_id
			AND a.id = e.event_status
			ORDER by e.start_time
			
		</statement>

		<statement name="person.sessionActivity">
			
			select 	decode(to_char(to_char(a.activity_stamp, 'MM/DD/YYYY HH12:MI AM'), 'YYYY'), to_char(sysdate, 'YYYY'), to_char(to_char(a.activity_stamp, 'MM/DD/YYYY HH12:MI AM'), 'Mon DD'), to_char(to_char(a.activity_stamp, 'MM/DD/YYYY HH12:MI AM'), 'MM/DD/YY')) as activity_date,
			b.caption as caption, a.activity_data as data,
			a.action_scope as scope, a.action_key as action_key
			from perSess_Activity a, Session_Action_Type b
			where 	activity_stamp &gt; (select max(activity_stamp) - 1 from perSess_Activity)
			and	a.session_id = ?
			and	a.action_type = b.id
			and 	rownum &lt;= 20
			order by activity_date desc
			
		</statement>

		<statement name="person.surgicalProcedures">
			
			SELECT
			data_text_a,
			decode(to_char(t.curr_onset_date, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(t.curr_onset_date, 'Mon DD'), to_char(t.curr_onset_date, 'MM/DD/YY')) AS curr_onset_date,
			ref.name,
			provider_id,
			trans_type,
			trans_id,
			'(CPT ' || t.code || ')' AS code
			FROM
			transaction t,
			ref_cpt ref
			WHERE
			trans_type = 4050
			AND trans_owner_id = :1
			AND t.code = ref.cpt (+)
			AND trans_status = 2
			ORDER BY
			curr_onset_date DESC
			
		</statement>

		<statement name="person.testsAndMeasurements">
			
			select tm.trans_owner_id, to_char(tm.trans_begin_stamp - ?, 'mm/dd/yyyy HH:MI PM'),tm.data_text_b,tm.data_text_a,tc.no_of_tests
			from testsandmeasurements tm, testsandmeasurementscount tc
			where tm.trans_owner_id = tc.trans_owner_id
			and tm.data_text_b = tc.data_text_b
			and tm.trans_owner_id = ?
			
		</statement>

		<statement name="sel_referral">
			
			SELECT
			trans_id,
			trans_owner_id,
			a.ssn,
			a.date_of_birth,
			t.data_text_a as referral_type,
			aa.value_int as claim_number,
			trans_substatus_reason,
			trans_status_reason,
			t.data_text_b,
			t.data_text_c,
			t.caption,
			decode(to_char(trans_begin_stamp, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(trans_begin_stamp, 'Mon DD'), to_char(trans_begin_stamp, 'MM/DD/YY')),
			decode(to_char(trans_end_stamp, 'YYYY'), to_char(sysdate, 'YYYY'), to_char(trans_end_stamp, 'Mon DD'), to_char(trans_end_stamp, 'MM/DD/YY')),
			t.data_text_a,
			t.data_num_a,
			detail,
			related_data,
			initiator_id
			from transaction t, person a, trans_attribute aa
			where trans_type = 6000
			and trans_id = ?
			and a.person_id = t.consult_id
			and aa.parent_id = t.trans_id
			and aa.item_name = 'Referral Insurance'
			
		</statement>

	</sql-statements>
</xaf>